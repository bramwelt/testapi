<h3>{{ctrl.pageHeader}}</h3>
<p>{{ctrl.pageParagraph}}</p>
<form class="form-inline" ng-show="ctrl.isUserResults">
<h4>Upload Results</h4>
<div class="form-group col-m-3">
     <input class="form-contrl btn btn-default" type = "file" file-model = "resultFile"/>
</div>
<div class="form-group col-m-3">
     <button class="btn btn-primary" ng-click = "ctrl.uploadFile()">upload result</button>
</div>
<div>
<lable>{{ctrl.uploadState}}</label>
</div>
</form>
<div class="row" style="margin-bottom:24px;"></div>
<div cg-busy="{promise:ctrl.authRequest,message:'Loading'}"></div>
<div cg-busy="{promise:ctrl.resultsRequest,message:'Loading'}"></div>
<div ng-show="ctrl.data" class="results-table">
    <table ng-data="ctrl.data.result" ng-show="ctrl.data" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Upload Date</th>
                <th>Test ID</th>
                <th>Status</th>
                <th>Log</th>
                <th>Operation</th>
                <th>Share List</th>
            </tr>
        </thead>

        <tbody>
            <tr ng-repeat="(index, result) in ctrl.data.tests">
                <td>{{ result.upload_date }}</td>
                <td><a ng-click="ctrl.gotoResultDetail(result.id, result._id)">{{ result.id }}</a></td>
                <td>{{ result.status }}</td>
                <td><a ng-click="ctrl.downloadLogs(result.id)">logs</a></td>
		<td>
                    <div class="btn-group" uib-dropdown>
                        <button id="single-button" type="button" class="btn btn-default btn-sm" uib-dropdown-toggle>
                            Operation<span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                            <li role="menuitem" ng-if="auth.currentUser.role == 'user'" ><a ng-class="{'button-disabled': result.status != 'review'}" ng-click="ctrl.toPrivate(result, 'private')">withdraw submit</a></li>
                            <li role="menuitem" ng-if="auth.currentUser.role == 'user'" ><a ng-class="{'button-disabled': result.status != 'private'}" ng-click="ctrl.toReview(result, 'review')">submit to review</a></li>
                            <li role="menuitem" ng-if="auth.currentUser.role == 'reviewer'" ><a ng-class="{'button-disabled': result.status == 'approved'}" ng-click="ctrl.toggleCheck(result, 'status', 'approve')">approve</a></li>
                            <li role="menuitem" ng-if="auth.currentUser.role == 'reviewer'" ><a ng-class="{'button-disabled': result.status == 'not approved'}" ng-click="ctrl.toggleCheck(result, 'status', 'not approved')">not approved</a></li>
                            <li role="menuitem" ><a ng-click="ctrl.openSharedModal(result)">share with</a></li>
                            <li role="menuitem" ng-if="auth.currentUser.openid == result.owner" ><a ng-click="ctrl.deleteTest(result._id)">delete</a></li>
                        </ul>
                    </div>
                </td>
                <td>
                    <div class="btn-group" uib-dropdown>
                        <button id="single-button" type="button" class="btn btn-default btn-sm" style="width:80px" uib-dropdown-toggle>
                            Share List<span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button" style="min-width:300%">
			    <li role="separator" class="divider"></li>
                            <li role="menuitem" ng-repeat="share in result.shared track by $index"><a>{{ share }}<i class="pull-right glyphicon glyphicon-remove" ng-click="ctrl.removeSharedUser(result, share)"></i></a></li>
                        </ul>
                    </div>
                </td>

            </tr>
        </tbody>
    </table>

    <div class="pages">
        <uib-pagination
            total-items="ctrl.totalItems"
            ng-model="ctrl.currentPage"
            items-per-page="ctrl.itemsPerPage"
            max-size="ctrl.maxSize"
            class="pagination-sm"
            boundary-links="true"
            rotate="false"
            num-pages="ctrl.numPages"
            ng-change="ctrl.update()">
        </uib-pagination>
    </div>
</div>

<div ng-show="ctrl.showError" class="alert alert-danger" role="alert">
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <span class="sr-only">Error:</span>
    {{ctrl.error}}
</div>

<style>
.button-disabled {
    pointer-events:none;
}
</style>
